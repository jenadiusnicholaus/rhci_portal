{% extends 'donor/base.html' %}
{% load static %}

{% block title %}My Donations | RHCI Donor Dashboard{% endblock %}
{% block header_title %}My Donations{% endblock %}

{% block content %}
<div class="row mb-4">
  <!-- Summary Cards -->
  <div class="col-lg-4 col-md-6 mb-4">
    <div class="card h-100">
      <div class="card-body">
        <div class="donation-summary-card">
          <div class="donation-summary-icon">
            <i class="fas fa-hand-holding-usd"></i>
          </div>
          <div>
            <h6 class="donation-summary-label">Total Donated</h6>
            <h3 class="donation-summary-value">{{ total_donated|default:"0 TZS" }}</h3>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="col-lg-4 col-md-6 mb-4">
    <div class="card h-100">
      <div class="card-body">
        <div class="donation-summary-card">
          <div class="donation-summary-icon secondary">
            <i class="fas fa-calendar-check"></i>
          </div>
          <div>
            <h6 class="donation-summary-label">Donations Made</h6>
            <h3 class="donation-summary-value">{{ donations_count|default:"0" }}</h3>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="col-lg-4 col-md-12 mb-4">
    <div class="card h-100">
      <div class="card-body">
        <div class="donation-summary-card">
          <div class="donation-summary-icon tertiary">
            <i class="fas fa-user-injured"></i>
          </div>
          <div>
            <h6 class="donation-summary-label">Patients Supported</h6>
            <h3 class="donation-summary-value">{{ patients_supported|default:"0" }}</h3>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Donation History -->
<div class="row mb-4">
  <div class="col-12">
    <div class="card">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="card-title">Donation History</h5>
        <a href="{% url 'donor_discover' %}" class="btn btn-primary">Make New Donation</a>
      </div>
      <div class="card-body">
        {% if donations %}
          <div class="table-responsive">
            <table class="table align-middle">
              <thead>
                <tr>
                  <th>Patient</th>
                  <th>Date</th>
                  <th>Amount</th>
                  <th>Payment Method</th>
                  <th>Status</th>
                  <th>Receipt</th>
                </tr>
              </thead>
              <tbody>
                {% for donation in donations %}
                  <tr>
                    <td>
                      <div class="d-flex align-items-center">
                        {% if donation.patient_photo %}
                          <img src="{{ donation.patient_photo.url }}" alt="{{ donation.patient_name }}" class="patient-avatar me-2">
                        {% else %}
                          <img src="{% static 'images/default-patient.png' %}" alt="{{ donation.patient_name }}" class="patient-avatar me-2">
                        {% endif %}
                        <div>
                          <div class="fw-medium">{{ donation.patient_name }}</div>
                          <div class="text-muted small">Case #{{ donation.case_id }}</div>
                        </div>
                      </div>
                    </td>
                    <td>{{ donation.date }}</td>
                    <td>{{ donation.amount }} {{ donation.currency }}</td>
                    <td>
                      <span class="payment-method">
                        {% if 'card' in donation.payment_method|lower %}
                          <i class="fas fa-credit-card me-1"></i>
                        {% elif 'paypal' in donation.payment_method|lower %}
                          <i class="fab fa-paypal me-1"></i>
                        {% elif 'mobile' in donation.payment_method|lower %}
                          <i class="fas fa-mobile-alt me-1"></i>
                        {% else %}
                          <i class="fas fa-money-bill me-1"></i>
                        {% endif %}
                        {{ donation.payment_method }}
                      </span>
                    </td>
                    <td>
                      <span class="donation-status {{ donation.status|lower }}">{{ donation.status }}</span>
                    </td>
                    <td>
                      <a href="{{ donation.receipt_url }}" class="btn btn-sm btn-outline-secondary">
                        <i class="fas fa-download me-1"></i> Receipt
                      </a>
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          
          <!-- Pagination -->
          {% if paginator.num_pages > 1 %}
            <div class="pagination-container d-flex justify-content-center mt-4">
              <ul class="pagination">
                {% if donations.has_previous %}
                  <li class="page-item">
                    <a class="page-link" href="?page=1" aria-label="First">
                      <span aria-hidden="true">&laquo;&laquo;</span>
                    </a>
                  </li>
                  <li class="page-item">
                    <a class="page-link" href="?page={{ donations.previous_page_number }}" aria-label="Previous">
                      <span aria-hidden="true">&laquo;</span>
                    </a>
                  </li>
                {% endif %}
                
                {% for num in paginator.page_range %}
                  {% if num == donations.number %}
                    <li class="page-item active"><span class="page-link">{{ num }}</span></li>
                  {% elif num > donations.number|add:'-3' and num < donations.number|add:'3' %}
                    <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
                  {% endif %}
                {% endfor %}
                
                {% if donations.has_next %}
                  <li class="page-item">
                    <a class="page-link" href="?page={{ donations.next_page_number }}" aria-label="Next">
                      <span aria-hidden="true">&raquo;</span>
                    </a>
                  </li>
                  <li class="page-item">
                    <a class="page-link" href="?page={{ paginator.num_pages }}" aria-label="Last">
                      <span aria-hidden="true">&raquo;&raquo;</span>
                    </a>
                  </li>
                {% endif %}
              </ul>
            </div>
          {% endif %}
          
        {% else %}
          <div class="empty-state text-center py-5">
            <img src="{% static 'images/empty-donations.svg' %}" alt="No donations" class="empty-state-img mb-4">
            <h4>No donations made yet</h4>
            <p class="text-muted">Start your journey of giving and make your first donation today</p>
            <a href="{% url 'donor_discover' %}" class="btn btn-primary mt-3">
              <i class="fas fa-hand-holding-heart me-2"></i> Make First Donation
            </a>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
  .donation-summary-card {
    display: flex;
    align-items: center;
  }
  
  .donation-summary-icon {
    width: 56px;
    height: 56px;
    background-color: rgba(43, 182, 115, 0.1);
    color: var(--primary);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 1rem;
    font-size: 1.5rem;
  }
  
  .donation-summary-icon.secondary {
    background-color: rgba(52, 152, 219, 0.1);
    color: #3498db;
  }
  
  .donation-summary-icon.tertiary {
    background-color: rgba(155, 89, 182, 0.1);
    color: #9b59b6;
  }
  
  .donation-summary-label {
    color: var(--gray);
    margin-bottom: 0.5rem;
  }
  
  .donation-summary-value {
    margin: 0;
    font-weight: 600;
  }
  
  .patient-avatar {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    object-fit: cover;
  }
  
  .empty-state-img {
    max-width: 200px;
    opacity: 0.7;
  }
  
  .donation-status {
    padding: 0.25rem 0.5rem;
    border-radius: 0.25rem;
    font-size: 0.75rem;
    font-weight: 500;
  }
  
  .donation-status.completed,
  .donation-status.succeeded {
    background-color: rgba(46, 204, 113, 0.1);
    color: #2ecc71;
  }
  
  .donation-status.pending,
  .donation-status.processing,
  .donation-status.initiated {
    background-color: rgba(241, 196, 15, 0.1);
    color: #f1c40f;
  }
  
  .donation-status.failed,
  .donation-status.declined {
    background-color: rgba(231, 76, 60, 0.1);
    color: #e74c3c;
  }
  
  .payment-method {
    color: var(--gray);
    font-size: 0.875rem;
  }
</style>
{% endblock %}