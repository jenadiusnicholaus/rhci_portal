{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block title %}RHCI Dashboard{% endblock %}

{% block extrastyle %}
{{ block.super }}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<style>
  :root {
    --primary: #102a43;
    --secondary: #2bb673;
    --bg-light: #f8f9fa;
    --bg-dark: #102a43;
    --text-light: #f8f9fa;
    --border-light: #e9ecef;
    --shadow: 0 2px 10px rgba(0,0,0,0.05);
  }
  
  /* Dashboard layout - wider container */
  .dashboard-metrics {
    background: white;
    padding: 25px;
    margin-bottom: 20px;
    border-radius: 8px;
    box-shadow: var(--shadow);
    max-width: 100%;
  }
  
  .metrics-title {
    font-size: 18px;
    font-weight: 500;
    margin: 0 0 25px 0;
    padding-bottom: 10px;
    border-bottom: 1px solid var(--border-light);
    color: #2d3748;
  }
  
  /* 4-column grid with wider cards */
  .metrics-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 22px;
  }
  
  /* Responsive adjustments */
  @media (max-width: 1400px) {
    .metrics-grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }
  
  @media (max-width: 992px) {
    .metrics-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }
  
  @media (max-width: 576px) {
    .metrics-grid {
      grid-template-columns: 1fr;
    }
    .dashboard-metrics {
      padding: 15px;
      max-width: 100%;
    }
  }
  
  .metric-card {
    background: white;
    border-radius: 10px;
    box-shadow: 0 3px 12px rgba(0,0,0,0.07);
    padding: 22px;
    border-left: 4px solid transparent;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    min-height: 100px;
  }
  
  .metric-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.12);
  }
  
  .metric-card .icon {
    width: 64px;
    height: 64px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 18px;
    flex-shrink: 0;
  }
  
  .metric-card .icon i {
    font-size: 26px;
  }
  
  .metric-card .content {
    flex-grow: 1;
  }
  
  .metric-card .label {
    color: #718096;
    font-size: 15px;
    display: block;
    margin-bottom: 6px;
    font-weight: 500;
  }
  
  .metric-card .value {
    font-size: 26px;
    font-weight: 600;
    color: #2d3748;
  }
  
  /* Color variations */
  .metric-card.blue { border-left-color: #3498db; }
  .metric-card.blue .icon { background: rgba(52, 152, 219, 0.1); color: #3498db; }
  
  .metric-card.green { border-left-color: #2ecc71; }
  .metric-card.green .icon { background: rgba(46, 204, 113, 0.1); color: #2ecc71; }
  
  .metric-card.orange { border-left-color: #e67e22; }
  .metric-card.orange .icon { background: rgba(230, 126, 34, 0.1); color: #e67e22; }
  
  .metric-card.purple { border-left-color: #9b59b6; }
  .metric-card.purple .icon { background: rgba(155, 89, 182, 0.1); color: #9b59b6; }
  
  .metric-card.dark { border-left-color: #34495e; }
  .metric-card.dark .icon { background: rgba(52, 73, 94, 0.1); color: #34495e; }
  
  .metric-card.red { border-left-color: #e74c3c; }
  .metric-card.red .icon { background: rgba(231, 76, 60, 0.1); color: #e74c3c; }
  
  .metric-card.teal { border-left-color: #1abc9c; }
  .metric-card.teal .icon { background: rgba(26, 188, 156, 0.1); color: #1abc9c; }
  
  .metric-card.yellow { border-left-color: #f1c40f; }
  .metric-card.yellow .icon { background: rgba(241, 196, 15, 0.1); color: #f1c40f; }
  
  /* Copyright footer */
  .rhci-footer {
    text-align: center;
    padding: 15px 0;
    margin-top: 30px;
    border-top: 1px solid var(--border-light);
    color: #718096;
    font-size: 13px;
  }
  
  /* REMOVE THESE TO SHOW ADMIN UI ELEMENTS */
  /*
  #recent-actions-module {
    display: none;
  }
  
  .dashboard-content .module,
  .colMS .module:not(.filtered) {
    display: none;
  }
  */
</style>
{% endblock %}

{% block content %}
<div id="content-main">
  <!-- Dashboard metrics -->
  <div class="dashboard-metrics">
    <div class="metrics-grid">
      <!-- Donors card -->
      <div class="metric-card blue">
        <div class="icon">
          <i class="fas fa-user-friends"></i>
        </div>
        <div class="content">
          <span class="label">Donors</span>
          <div class="value">{{ donor_count|default:"0" }}</div>
        </div>
      </div>
      
      <!-- Beneficiaries card -->
      <div class="metric-card green">
        <div class="icon">
          <i class="fas fa-user-injured"></i>
        </div>
        <div class="content">
          <span class="label">Beneficiaries</span>
          <div class="value">{{ beneficiaries_count|default:"0" }}</div>
        </div>
      </div>
      
      <!-- Active Cases card -->
      <div class="metric-card orange">
        <div class="icon">
          <i class="fas fa-notes-medical"></i>
        </div>
        <div class="content">
          <span class="label">Active Cases</span>
          <div class="value">{{ active_cases|default:"0" }}</div>
        </div>
      </div>
      
      <!-- Referrals card -->
      <div class="metric-card yellow">
        <div class="icon">
          <i class="fas fa-exchange-alt"></i>
        </div>
        <div class="content">
          <span class="label">Referrals</span>
          <div class="value">{{ referrals_count|default:"0" }}</div>
        </div>
      </div>
      
      <!-- Pending Donations card -->
      <div class="metric-card red">
        <div class="icon">
          <i class="fas fa-hourglass-half"></i>
        </div>
        <div class="content">
          <span class="label">Pending Donations</span>
          <div class="value">{{ pending_donations|default:"0" }}</div>
        </div>
      </div>
      
      <!-- Total Donations card -->
      <div class="metric-card dark">
        <div class="icon">
          <i class="fas fa-hospital-user"></i>
        </div>
        <div class="content">
          <span class="label">Total donation</span>
          <div class="value">{{ donation_total|default:"0 TZS" }}</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Recent Activity -->
  <div class="dashboard-metrics">
    <div class="metrics-title">Recent Activity</div>
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px;">
      <!-- Recent Patients -->
      <div>
        <h3 style="font-size: 16px; margin-bottom: 12px;">Recent Patients</h3>
        <table style="width: 100%; border-collapse: collapse;">
          <thead>
            <tr>
              <th style="text-align: left; padding: 8px; border-bottom: 1px solid #eee;">Name</th>
              <th style="text-align: left; padding: 8px; border-bottom: 1px solid #eee;">City</th>
            </tr>
          </thead>
          <tbody>
            {% for patient in recent_patients %}
            <tr>
              <td style="padding: 8px; border-bottom: 1px solid #eee;">
                <a href="{% url 'admin:beneficiaries_patient_change' patient.id %}">
                  {{ patient.first_name }} {{ patient.last_name }}
                </a>
              </td>
              <td style="padding: 8px; border-bottom: 1px solid #eee;">{{ patient.city }}</td>
            </tr>
            {% empty %}
            <tr><td colspan="2" style="padding: 8px;">No recent patients</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      
      <!-- Recent Donations -->
      <div>
        <h3 style="font-size: 16px; margin-bottom: 12px;">Recent Donations</h3>
        <table style="width: 100%; border-collapse: collapse;">
          <thead>
            <tr>
              <th style="text-align: left; padding: 8px; border-bottom: 1px solid #eee;">Amount</th>
              <th style="text-align: left; padding: 8px; border-bottom: 1px solid #eee;">Status</th>
              <th style="text-align: left; padding: 8px; border-bottom: 1px solid #eee;">Date</th>
            </tr>
          </thead>
          <tbody>
            {% for donation in recent_donations %}
            <tr>
              <td style="padding: 8px; border-bottom: 1px solid #eee;">
                <a href="{% url 'admin:donations_donation_change' donation.id %}">
                  {{ donation.amount }} {{ donation.currency }}
                </a>
              </td>
              <td style="padding: 8px; border-bottom: 1px solid #eee;">{{ donation.status }}</td>
              <td style="padding: 8px; border-bottom: 1px solid #eee;">{{ donation.created_at|date }}</td>
            </tr>
            {% empty %}
            <tr><td colspan="3" style="padding: 8px;">No recent donations</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

 

  <!-- Copyright footer -->
  <div class="rhci-footer">
    &copy; {% now "Y" %} RHCI. All rights reserved.
  </div>
</div>
{% endblock %}